---
title: "Steatose Non Alcolic"
author: "V. Monbet"
date: "2025-09-23"


output:
  html_document:
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

knitr::opts_chunk$set(
  fig.width = 5, 
  fig.height = 5 * 0.618,  # Golden rectangles!
  fig.align = "center", 
  out.width = "60%"
)
```

# Student test, examples

This report shows how to perform Student t-tests in R. 

R commands are reported, to hide them turn echo to FALSE in knitr::opts_chunk$set. 

```{r libraries}
library(ggplot2)
#install.packages("cond")
library(cond)
```

On importe les données de l'article de Martin (2025)
```{r libraries}

## Paired samples

 Hollander et Wolfe (1973), 29f.
 Hamilton depression scale factor measurements in 9 patients with  mixed anxiety and depression, taken at the first (x) and second  (y) visit after initiation of a therapy (administration of a tranquilizer).
 
 The hull hypothesis is that the therapy has no effect such that $\mu_x = \mu_y$, the alternative is that the dépression symptoms décrease such that $\mu_x > \mu_y$.
 
 Samples are paired : the same individuals takes the 2 visits. 

The test is performed at risk 0.05.
```{r data }

alpha = 0.05
x = c(1.83,  0.50,  1.62,  2.48, 1.68, 1.88, 1.55, 3.06, 1.30)
y = c(0.878, 0.647, 0.598, 2.05, 1.06, 1.29, 1.06, 3.14, 1.29)
z = y-x

```

Fistly, a normality test is run. 
```{r shapiro  }
res_shapiro = shapiro.test(z)

df = data.frame(z)
p <- ggplot(df, aes(sample = z)) +   stat_qq() +
  stat_qq_line() + ggtitle(paste("Shapiro test's pvalue : ", round(res_shapiro$p.value,2)))
p
```
```{r  test }
if (res_shapiro$p.value>alpha) {
  t.test(z,alternative="less")
} else {
  wilcoxon.test(z,alternative="greater")
}

```

Qqplots may be difficult to interpret
```{r simulations }
par(mai=c(.3,.3,.4,.3),mfrow=c(1,3))
qqnorm(rnorm(length(z)*3),pch=20,main="Gauss, n=30",xlim=c(-2,2),ylim=c(-2,2))
abline(a=0,b=1)
qqnorm(rnorm(length(z)),pch=20,main="Gauss, n=9",xlim=c(-2,2),ylim=c(-2,2))
abline(a=0,b=1)
qqnorm(z,pch=20,main="Observations, n=9",xlim=c(-2,2),ylim=c(-2,2))
abline(a=0,b=1)
```

## Two-sample test 
 79 urine specimens were analyzed in an effort to determine  if certain physical characteristics of the urine might be related 
 to the formation of calcium oxalate crystals. 

 Cases 1 and 55 have missing covariates.


```{r data urine}
data(urine)

head(urine) # pour voir ce que contient la table de donnees
```

### Osmolarité,  Boxplot and qqplots
```{r osmo boxplot}

ggplot(urine, aes(x=r, y=osmo, fill=r)) + 
    geom_boxplot()
```

```{r osmo qqplots}
p <- ggplot(urine, aes(sample = osmo, colour = factor(r))) +
  stat_qq() +
  stat_qq_line()
p
```

### Normality test by group
```{r osmo shapiro tests}
sh1 = shapiro.test(scale(urine$osmo[urine$r==1]))
print(paste("Shapiro test pvalue, group 1 :",round(sh1$p.value,2)))

sh0 = shapiro.test(scale(urine$osmo[urine$r==0]))
print(paste("Shapiro test pvalue, group 0 :",round(sh1$p.value,2)))
```

Pvalues are both greater than  0.05, the null hypothesis "distribution is gaussian" can not be rejected. 

### Comparison of variances

```{r osmo variance test}
vt = var.test(osmo~r,data=urine)
print(paste("Fisher test pvalue :",round(vt$p.value,2)))

print(vt)
```
The pvalue is greater thant 0.05, the null hypothesis "equal variances" can not be rejected and the Student t test can be used to compare the means. 

#### Test de Student
```{r osmo t test}
tt = t.test(osmo~r,data=urine,alternative="greater",var.equal=TRUE)
print(paste("Pvalue du test de Student :",round(tt$p.value,2)))
```

The pvalue is grater than 0.05, the null hypothesis "equal means" can not be rejected. 

We conclude that osmolarity is not significantly different in groups with and without presence of calcium oxalate crystals. 
<!-- # Calcium ----- -->
<!-- # Boxplot et qqplots -->
<!-- par(mfrow=c(1,3),mai=c(.3,.3,.2,.2)) -->
<!-- boxplot(calc~r,data=urine,xlab="groupe",ylab="osmo") -->
<!-- qqnorm(scale(urine$calc[urine$r==0]),main="Groupe 0",pch=20) -->
<!-- abline(a=0,b=1) -->
<!-- qqnorm(scale(urine$calc[urine$r==1]),main="Groupe 1",pch=20) -->
<!-- abline(a=0,b=1) -->

<!-- # Test de normalité par groupe -->
<!-- sh1 = shapiro.test(scale(urine$calc[urine$r==1])) -->
<!-- print(paste("Pvalue du test de Shapiro pour le groupe 1 :",round(sh1$p.value,2))) -->
<!-- sh0 = shapiro.test(scale(urine$calc[urine$r==0])) -->
<!-- print(paste("Pvalue du test de Shapiro pour le groupe 0 :",round(sh0$p.value,2))) -->
<!-- # Comparaison des variances -->
<!-- vt = var.test(osmo~r,data=urine) -->
<!-- print(paste("Pvalue du test de Fisher :",round(vt$p.value,2))) -->
<!-- print(vt) -->

<!-- # Test de Mann-Whitney-Wilcoson -->
<!-- W = wilcox.test(urine$calc[urine$r==1],urine$calc[urine$r==0],alternative="greater") -->
<!-- print(paste("Pvalue du test de Wilcoxon :",round(W$p.value,6))) -->


<!-- ``` -->

<!-- ## Including Plots -->

<!-- You can also embed plots, for example: -->

<!-- ```{r pressure, echo=FALSE} -->
<!-- plot(pressure) -->
<!-- ``` -->

<!-- Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot. -->
